class Display

  def init
    @wait = 100              # Speed
    @x = Display::WIDTH / 2  # Initial location
    @y = Display::HEIGHT / 2
    @mw = 8                  # Mushroom size
    @mh = 7
    @mr = '00000000003344000343343034434334344343340022220000111100'.split('').map(&:to_i)
    @me = '00334400034334300343343034434334344343340022220000111100'.split('').map(&:to_i)
    @mm = [
"344444444444444444444444444444433333333344444444444444444433333333234433333333322211111112222222",
"444444444444444444444444444323333333333444444444444444444333333333334444333333343322111111222222",
"444444444444444444444322334202333333444444444444444443433333333333444444443334333433211111122222",
"444444444444444444444333333433333334444444444444444433333333333344444444444433343334322211111222",
"444444444444444444444443333333333444444444444444444333333333334444444444444443333333343222111111",
"444444444444444444444444433333344444444444444444433443333333344444444444444444433333334432211111",
"444444444444444444444444444333444444444444444443333444333334444444444444444444444333334433221111",
"444444444444444444444444444444444444444444444433333344443344444444444333332222434443344333322211",
"444444444444444444444444444444444444444444444333333333333333222222222122222122343344444321112221",
"344444444444444434444444444444444212234444433333333322222222222222222222222222133134443432112122",
"234444444444444421444444444444431111122333333333333322222222222222121212121211024214444434321122",
"344444444444444210134444444444211111111233333333223333333111110201011111111111213411444443332111",
"444444444444443100002444444421011111111232333333222233333202111111112121212111111431244444433321",
"444444444444442000000124444100111111121210123333322333333311112121111111121212121242134334443333",
"444444444444431000000001221111111112222211123333323432333420211111121212111111112134224334434433",
"444444444444420000001111111111222233334211122332112333333331120212111111212121111113434444333444",
"434444444444411111111112222233333333244311222332122333333332121121212121111112121213433444333333",
"443344444343411111222333444433332222233212222333323333333334102021221112232223223333334444333333",
"444444431034322334444433344222222222211111222233422424333333322222232333333344434433343344444333",
"444444421124444433333323222222222111121222212233343433332233333334444444444444444342243433344443",
"444444421123333322233332223321222111122122212223344443333344444444444444444444333232233343334444",
"444444421123333322233333333332222211122122221023333334344444444444444443333323222222233334444444",
"344444422222333333332333332332222221222121111113332233333344344323433322223332234444333333344443",
"444444422332333222232333333332222222221111111112443221223322221232233322334444444444433333333444",
"444444432233333333332233333333222211121111110113444212121000000133233333444444444444443333333344",
"444444432233232333222233333332211111111100111124444321220000000024444444444444444444444333333334",
"444444432233323232222233333222111001111222232223444443430000000014444444444444444444444333333333",
"444444442211122211223322222222211222222322221224444444440000000001444444444444444443444433333333",
"444444442211121211222222221222222222321333333343444444441000000000124444444444444444434333333333",
"444444443211121111222233333322222233333444444433444444444100000000001444444444444444433433333333",
"443444443111122334433222221112233444444444444433444444444100000000000244444444344444443433333333",
"444344444211223332222111223344444444444444433333344444444100000000000144444444444444444343333333",
"444344444211222211122233444444444444444444433333344444443000000000000024444444444444444344333333",
"444434444321233333333334444444444444443443333333344444443000000000000013444444444444444444333333",
"444443444444444433333334444444444444433333333333334444444100000001111113444444444444443444333333",
"444444344444444443333343344444443333333333333333334444434200111111111112444444444444443334443333",
"444444434443444444333333444433333433333333333333334444434301111111111111344444444444444333443333",
"444444443443444444443334444333333333333333333333334334334411111111111111244444443444444433343333",
"444444444443444444443344444333333333333333333333333334334421211111111111134444443444444433334434",
"444444444344444444443444444333333333333333333333333333334442111111111111124444444344444433333443",
"444444444434444444444444444333333333333333333333333333334443111111111111123444444334444443333344",
"444444444443444444444444444333333333333333333333333333334444211111111111112444444334444444333333",
"444444444443444444444444444333333333333333322333322333334444311111111111112344444333444344433333",
"444444444444344444444444444333333333333333333333333333333444421111111111111244444333444444444433",
"444444444444434444444443343333333333333233333333333333333333431111111111112334434433323333333333",
"443344444444444433333333333333333333323233333333333333233334432211111111123333443432222222222244",
"333333333444443433333333333333333333333333333333333333333344442122211111234333343444333444443444",
"333333333344444443333333333333333333333333333322332333333344443122221111233333344344333334444334"]
    @mm = @mm.join.split('').map(&:to_i)
  end

  def update
    self.clear
    # self.put_mushroom(@x, @y)
    self.draw
  end

  def keydown(key)
    @x += 1 if key == 68 # D
    @x -= 1 if key == 65 # A
    @y += 1 if key == 83 # S
    @y -= 1 if key == 87 # W
    @x = 0 if @x < 0
    @x = Display::WIDTH - @mw if @x + @mw >= Display::WIDTH
    @y = 0 if @y < 0
    @y = Display::HEIGHT - @mh if @y + @mh >= Display::HEIGHT
  end

  def draw
    @buf = []
    @buf.concat(@mm)
  end

  def put_mushroom(x, y)
    aa = @c % 10 < 5 ? @mr : @me
    aa.each_with_index do |e, i|
      self[x + i % @mw, y + (i / @mw).to_i] = e
    end
  end

end
